{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
<form method="post">
  <table>
      <tr>
      <th width = 130px> <H3 style=font-size:30px> <a href="/search"><img src="/static/gigglelogo.png" width = "50px" style = "padding-bottom: 0px;" alt="Gi"><font color = "#a4a5a6" style = "font-family:Times New Roman; ">ggle</font></a></H3> </th>
      <th width = 600px> <input class="form-control form-control-lg form-control-borderless" type="search" name="Input"  placeholder="{{identifier}} from {{source}}"></H1> </th>
      <th width = 25px></th>
      <th width = 600px>   <h4> {{ form.submit(class="btn btn-md btn-primary") }}   <a class="btn btn-danger" data-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">Filter</a></h4> </th>
      </tr>
    </table>
    {{ form.csrf_token }}       
  </form>
    <div class="row">
      <div class="col">
        <div class="collapse multi-collapse" id="multiCollapseExample1">
          <div class="card card-body">
              <div class="panel panel-default">
                  <div class="panel-body">{{ wtf.quick_form(filterform) }}   </div>
                </div>      
            </div>
        </div>
      </div>
    </div>

    
    {% if "LenIntervals" in session and  session["LenIntervals"] > 1 %}
  <div class="container">
      <div class="row"> 
        {% for intvset in session["intervals"] %}
          <span class="col-sm-3">
          <div class="progress">
              <div class="progress-bar" role="progressbar" style="width:15%; background-color:rgb(20, 65, 119) !important;">  {{intvset[0][0]}} </div>
                {% for intv in intvset %}
                <div class="progress-bar" role="progressbar" style="width:0.2%; background-color:rgb(250, 250, 250) !important;"></div>
                <a href="{{"/result/{}/{}:{}-{}".format(intv[3], intv[0], intv[1], intv[2])}}">
                {% if intv[0]+":"+intv[1]+"-"+intv[2] == identifier %}
                    <div class="progress-bar progress-bar-success" role="progressbar" style="width:30%; background-color:rgb(233, 78, 73) !important;"> {{intv[1]}}:{{intv[2]}} </div>
                {% else %}
                    <div class="progress-bar progress-bar-success" role="progressbar" style="width:30%; background-color:rgb(102, 159, 250) !important;"> {{intv[1]}}:{{intv[2]}} </div>
                    {% endif %}
                  </a>
                {% endfor %}
          </div>
          </span>
        {% endfor %}
        {% if identifier == "combined" %}
        <a href="{{"/result/{}/combined".format(source)}}">
          <div class="progress-bar" role="progressbar" style="width:10%; background-color:rgb(219, 51, 32) !important;">  Compiled Search</div>
        </a>
        {% else %}
        <a href="{{"/result/{}/combined".format(source)}}">
          <div class="progress-bar" role="progressbar" style="width:10%; background-color:rgb(102, 159, 250) !important;">  Compiled Search</div>
        </a>        
        {% endif %}
      </div>
    </div>
    {% endif %}

    <h6><font color="#144177">{{numresults}} overlapping regions found for {{identifier}} from {{source}} data ({{searchtime}} seconds)</font></h6>

    <table class="table table-hover">
            <tbody>
            {% for value in results%}
                <tr>
                  <td>
                      {% if value[3] == "" or  value[4] == ""%}
                        <h4> <font color="#144177">{{ value[0] }}</font> </h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} </font></h5>
                      {% elif  value[5] == ""%}
                        <h4> <font color="#144177">{{ value[3] }} : {{value[4]}}</font> </h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} - Table Name: {{ value[0] }}</font></h5>
                      {% else%}
                        <h4><font color="#144177">{{ value[3] }} : {{value[4]}}</font> <a href="#" data-toggle="modal" data-target='#descriptionModal{{ value[1] }}{{ value[2] }}' ><i class="fa fa-edit"></i> &#9432;</a></h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} - Table Name: {{ value[0] }} </font></h5>
                        {{ value[6][:-4] | safe}} <a href="#" data-toggle="modal" data-target='#descriptionModal{{ value[1] }}{{ value[2] }}' ><i class="fa fa-edit"></i> &#8690;</a></p>
                      {% endif %}
                    
                  </td>
                </tr>

            {% endfor %}
          </tbody>
          </table>
          {% for value in results%}
          {% if value[5] != "" %}
          <div class="modal fade" id="descriptionModal{{ value[1] }}{{ value[2] }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="modal-title"><font color="#144177">{{ value[3] }} : {{value[4]}}</font></h2>
                  </div>
                  <div class="modal-body">
                        {{ value[5] | safe}}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
            <script> $('#descriptionModal{{ value[1] }}{{ value[2] }}').modal(show); </script>
            {% endif %}
            {% endfor %}

            <center> 
            <h1>
                <table>
                    <tr>
                        {% if page != 1 %}
                        <td width = 100>
                            <a href="{{"/result/{}/{}/pg:{}".format(source, identifier, page-1)}}">
                            <table >
                                <tr>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<</tr>
                                <tr><h4>Previous</h4></tr>
                            </table>
                            </a>
                        </td>
                        {% endif %}
                        <td width = 5>
                            <table >
                              <tr><font color="#7fcdbb">Gi</font></tr>
                              <tr><font color="white"><h5>_</h5></font></tr>
                            </table>
                        </td>
                        {% if pageNums == [1]%}
                        <td width = 5>
                            <table>
                            <tr><font color = "#144177">g</font></tr>
                            <tr><font color="white"><h5>_</h5></font></tr>
                            </table>
                        </a>
                        </td>
                        {% endif %}
                        {% for i in pageNums %}
                          {% if i != page%}
                          <td width = 5>
                              <a href="{{"/result/{}/{}/pg:{}".format(source, identifier, i)}}">
                              <table>
                              <tr><font color = "#144177">g</font></tr>
                              <tr><h5>&nbsp;{{i}}</h5></tr>
                              </table>
                          </a>
                          </td>
                          {% else %}
                          <td width = 5>
                              <table>
                                  <tr><font color = "#B12401">g</font></tr>
                                  <tr><h5>&nbsp;{{i}}</h5></tr>
                              </table>
                              </td>
                          {% endif %}
                      {% endfor %}
                            <td width = 5>
                                <table >
                                  <tr><font color="#7fcdbb">le</font></tr>
                                  <tr><font color="white"><h5>_</h5></font></tr>
                                </table>
                            </td>
                        <td width = 30> 
                          </td>
                        <td> 
                            <a href="{{"/result/{}/{}/pg:{}".format(source, identifier, page+1)}}">
                            <table>
                                <tr>></tr>
                                <tr><h4>Next</h4></tr>
                            </table>
                            </a>
                          </td>
                      </tr>
                    </table>


                  </h1>
                </center> 

{% endblock %}