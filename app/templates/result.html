{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block app_content %}
<script  type="text/javascript">
      function paginate(currentPage){
        document.getElementById("searchInfo").innerHTML = "<font color=\"#144177\">Showing Results "+parseInt((currentPage-1)*10)+"-"+parseInt(currentPage*10)+"</font>";
        //Logic for pagination max 10 page links
        //Once it gets to 5 it stays and drops previous
        //current is 3: P 1 2 3 4 5 6 7 8 9 N
        //current is 6: P 2 3 4 5 6 7 8 9 10 N
        // always at least has 4 above it
        var res = {{allresults|tojson}};
        var maxPage = Math.ceil(res.length/10);
        var newPages = "<table><tr>";
        
        //If currentPage is 0 then add previous
        if (currentPage != 1) {
          newPages += "<td width = 100>";
          newPages += "<a onclick = \"show(" + parseInt(currentPage-1) +")\" href=\"#\">";
          newPages += "<table > <tr>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<</tr> <tr><h4>Previous</h4></tr> </table> </a> </td>";
        }
        //Add Gi
        newPages += "<td width = 5> <table > <tr><font color=\"#7fcdbb\">Gi</font></tr> <tr><font color=\"white\"><h5>_</h5></font></tr> </table> </td>";

        for (i = 1 ; i <= maxPage ; i++) {
          if (currentPage != i) {
            newPages += "<td width = 5><a onclick = \"show("+parseInt(i)+")\" href=\"#\"><table><tr><font color = \"#144177\">g</font></tr><tr><h5>&nbsp;"+i+"</h5></tr></table></a></td>";
          } else {
            newPages += "<td width = 5> <table> <tr><font color = \"#B12401\">g</font></tr> <tr><h5>&nbsp;"+i+"</h5></tr> </table></td>";
          }
        }
        //if only 1 g then add another
        if (maxPage == 1){
          newPages += "<td width = 5> <table> <tr><font color = \"#144177\">g</font></tr> <tr><h5>&nbsp;</h5></tr> </table></td>";
        }

        //Adds gle
        newPages += "<td width = 5><table ><tr><font color=\"#7fcdbb\">le</font></tr><tr><font color=\"white\"><h5>_</h5></font></tr></table><td width = 30> </td>";

        //Add next if there is a next
        if (currentPage < maxPage){
          newPages += "<td> <a onclick = \"show("+parseInt(currentPage+1)+")\" href=\"#\"> <table> <tr>></tr> <tr><h4>Next</h4></tr> </table> </a></td> </tr>";
        }
        newPages += "</table>";
        document.getElementById("paginationTable").innerHTML = newPages;
      }

      function show(p){
        var results = {{ allresults|tojson }};
        var newTable = "<table><tbody>";
        if (results.length > (p)*10) {
          var upperBound = (p)*10;
        } else {
          var upperBound = results.length;
        }
        for (j = (p-1)*10 ; j < upperBound ; j++) {
          newTable += "<tr><td>";
          if (results[j][3] == "" && results[j][4] == "") {
            newTable += "<h4> <font color=\"#144177\">" + results[j][0] + "</font> </h4> <h5><font color=\"#7fcdbb\"> Overlap: " + results[j][2] + "  -  Region Size: " + results[j][1] + " </font></h5>";
          } else if (results[j][5] == "") {
            newTable += "<h4> <font color=\"#144177\">" + results[j][3] + " : " + results[j][4] + "</font> </h4> <h5><font color=\"#7fcdbb\"> Overlap: " + results[j][2] + "  -  Region Size: " + results[j][1] + " - Table Name: " + results[j][0] + " </font></h5>";
          } else {
            newTable += "<h4><font color=\"#144177\">" + results[j][3] + " : " + results[j][4] + "</font> <a href=\"#\" data-toggle=\"modal\" data-target=\"#descriptionModal"+results[j][7]+"\"><i class=\"fa fa-edit\"></i> &#9432;</a></h4>";
            newTable += "<h5><font color=\"#7fcdbb\"> Overlap: " + results[j][2] + "  -  Region Size: " + results[j][1] + " - Table Name: " + results[j][0] + " </font></h5>";
            for(i = 0 ; i <= results[j][6].length - 5 ; i++) {
              newTable += results[j][6][i];
            }
            newTable += "<a href=\"#\" data-toggle=\"modal\" data-target=\"#descriptionModal"+results[j][7]+"\"><i class=\"fa fa-edit\"></i> &#8690;</a></p>";
          }
          newTable += "</td></tr>";
        }
        newTable += "</table></tbody>";
        paginate(p);
        document.getElementById("resultTable").innerHTML = newTable;
      }
</script>

<form method="post">
  <table>
      <tr>
      <th width = 130px> <H3 style=font-size:30px> <a href="/search"><img src="/static/gigglelogo.png" width = "50px" style = "padding-bottom: 0px;" alt="Gi"><font color = "#a4a5a6" style = "font-family:Times New Roman; ">ggle</font></a></H3> </th>
      <th width = 600px> <input class="form-control form-control-lg form-control-borderless" type="search" name="Input"  placeholder="{{identifier[0]}} {{identifier[1]}}:{{identifier[2]}} from {{source}}"></H1> </th>
      <th width = 25px></th>
      <th width = 600px>   <h4> {{ form.submit(class="btn btn-md btn-primary") }}   </h4> </th>
      </tr>
    </table>
    {{ form.csrf_token }}       
  </form>
    
  {% if "LenIntervals" in session and  session["LenIntervals"] > 1 %}
    <div class="container">
        <div class="row"> 
          {% for intvset in session["intervals"] %}
            <span class="col-sm-3">
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width:15%; background-color:rgb(20, 65, 119) !important;">  {{intvset[0][0]}} </div>
                  {% for intv in intvset %}
                  <div class="progress-bar" role="progressbar" style="width:0.2%; background-color:rgb(250, 250, 250) !important;"></div>
                  <a href="{{"/result/{}/{}:{}-{}".format(intv[3], intv[0], intv[1], intv[2])}}">
                  {% if intv[0] == identifier[0] and intv[1] == identifier[1] and intv[2] == identifier[2] %}
                      <div class="progress-bar progress-bar-success" role="progressbar" style="width:30%; background-color:rgb(233, 78, 73) !important;"> {{intv[1]}}:{{intv[2]}} </div>
                  {% else %}
                      <div class="progress-bar progress-bar-success" role="progressbar" style="width:30%; background-color:rgb(102, 159, 250) !important;"> {{intv[1]}}:{{intv[2]}} </div>
                      {% endif %}
                    </a>
                  {% endfor %}
            </div>
            </span>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    
    <h6><font color="#144177">{{numresults}} overlapping regions found for {{identifier[0]}} {{identifier[1]}}:{{identifier[2]}} from {{source}} data ({{searchtime}} seconds)</font></h6>
    <h6 id="searchInfo"><font color="#144177">Showing Results 0-10</font></h6>

    <table class="table table-hover" id="resultTable">
        <tbody>
            {% for value in allresults[0:10]%}
                <tr>
                  <td>
                      {% if value[3] == "" or  value[4] == ""%}
                        <h4> <font color="#144177">{{ value[0] }}</font> </h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} </font></h5>
                      {% elif  value[5] == ""%}
                        <h4> <font color="#144177">{{ value[3] }} : {{value[4]}}</font> </h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} - Table Name: {{ value[0] }}</font></h5>
                      {% else%}
                        <h4><font color="#144177">{{ value[3] }} : {{value[4]}}</font> <a href="#" data-toggle="modal" data-target='#descriptionModal{{value[7]}}' ><i class="fa fa-edit"></i> &#9432;</a></h4>
                        <h5><font color="#7fcdbb"> Overlap: {{ value[2] }}  -  Region Size: {{ value[1] }} - Table Name: {{ value[0] }} </font></h5>
                        {{ value[6][:-4] | safe}} <a href="#" data-toggle="modal" data-target='#descriptionModal{{value[7]}}' ><i class="fa fa-edit"></i> &#8690;</a></p>
                      {% endif %}
                    
                  </td>
                </tr>

            {% endfor %}
          </tbody>
          </table>
          {% for value in allresults%}
            {% if value[5] != "" %}
              <div class="modal fade" id="descriptionModal{{value[7]}}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h2 class="modal-title"><font color="#144177">{{ value[3] }} : {{value[4]}}</font></h2>
                      </div>
                      <div class="modal-body">
                            {{ value[5] | safe}}
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
            
            <center> 
                <h1>
                    <table id="paginationTable">
                        <tr>
                            {% if page != 1 %}
                            <td width = 100>
                                <a onclick = "show({{page}}-1)" href="#">
                                <table >
                                    <tr>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<</tr>
                                    <tr><h4>Previous</h4></tr>
                                </table>
                                </a>
                            </td>
                            {% endif %}
                            <td width = 5>
                                <table >
                                  <tr><font color="#7fcdbb">Gi</font></tr>
                                  <tr><font color="white"><h5>_</h5></font></tr>
                                </table>
                            </td>
                            {% if pageNums == [1]%}
                            <td width = 5>
                                <table>
                                <tr><font color = "#144177">g</font></tr>
                                <tr><font color="white"><h5>_</h5></font></tr>
                                </table>
                            </a>
                            </td>
                            {% endif %}
                            {% for i in pageNums %}
                              {% if i != page %}
                              <td width = 5>
                                  <a onclick = "show({{i}})" href="#">
                                  <table>
                                  <tr><font color = "#144177">g</font></tr>
                                  <tr><h5>&nbsp;{{i}}</h5></tr>
                                  </table>
                              </a>
                              </td>
                              {% else %}
                              <td width = 5>
                                  <table>
                                      <tr><font color = "#B12401">g</font></tr>
                                      <tr><h5>&nbsp;{{i}}</h5></tr>
                                  </table>
                                  </td>
                              {% endif %}
                          {% endfor %}
                                <td width = 5>
                                    <table >
                                      <tr><font color="#7fcdbb">le</font></tr>
                                      <tr><font color="white"><h5>_</h5></font></tr>
                                    </table>
                                </td>
                            <td width = 30> 
                              </td>
                            <td> 
                                <a onclick = "show({{page}}+1)" href="#">
                                <table>
                                    <tr>></tr>
                                    <tr><h4>Next</h4></tr>
                                </table>
                                </a>
                              </td>
                          </tr>
                        </table>
    
    
                      </h1>
                    </center> 
    
{% endblock %}